<% indicators.each do |indicator| %>
  <div class="bank-assessment__indicator">
    <div class="bank-assessment__indicator-header">
      <h4>
        <%= indicator.indicator.display_text %>
      </h4>
      <div class="bank-assessment__indicator-value">
        <div>
          <% if indicator.virtual? %>
            N/A
          <% elsif indicator.indicator.is_placeholder %>
            N/A
          <% elsif indicator.percentage.present? %>
            <%= number_with_precision(indicator.percentage, precision: 1, strip_insignificant_zeros: true) %>%
          <% else %>
            N/A
          <% end %>
        </div>
      </div>
    </div>

    <div class="bank-assessment__sub-indicators">
      <% if indicator.virtual? %>
        <%# For virtual indicators, get sub-indicators directly from the database %>
        <% sub_indicators = BankAssessmentIndicator.active.where(indicator_type: 'sub_indicator').select { |si| si.number.start_with?("#{indicator.indicator.number}.") } %>
        <% sub_indicators = sub_indicators.map do |sub_indicator|
          OpenStruct.new(
            id: "virtual_#{sub_indicator.id}",
            indicator: sub_indicator,
            answer: 'N/A',
            virtual: true
          )
        end %>
      <% else %>
        <% sub_indicators = assessment.child_indicators(indicator, "sub_indicator") %>
      <% end %>
      
      <% sub_indicators.each do |sub_indicator| %>
        <div class="bank-assessment__sub-indicator">
          <div class="bank-assessment__sub-indicator-answer-wrapper">
            <span class="bank-assessment__sub-indicator-answer bank-assessment__sub-indicator-answer--<%= (sub_indicator.answer || 'N/A').parameterize %>">
              <%= sub_indicator.virtual? ? 'N/A' : (sub_indicator.answer || 'N/A') %>
            </span>
          </div>
          <div class="bank-assessment__sub-indicator-answer-text">
            <%= sub_indicator.indicator.display_text %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
