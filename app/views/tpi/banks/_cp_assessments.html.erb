<h3 class="cp_assessments_title" style="margin: 25px 0">
  Carbon performance of <%= @bank.name %>
</h3>
<p>
  The sectoral means are computed from the company data in TPIâ€™s Carbon Performance Assessments.
</p>
<% cp_assessments = Queries::TPI::LatestCPAssessmentsQuery.new(category: Bank, cp_assessmentable: @bank).call %>
<% cp_sectors = TPISector.for_category(Bank).order(:name).map { |sector|
   cp_assessment = cp_assessments[[@bank, sector]]&.first
    {
      name: sector.name,
      assessment: cp_assessment,
      dataUrl: emissions_chart_data_tpi_bank_path(@bank, sector_id: sector.id),
      unit: cp_assessment&.unit
    }
  }.select { |sector| 
    assessment = sector[:assessment]
    
    assessment.present? && 
    assessment.emissions.present? && 
    assessment.years_with_targets.present? && 
    assessment.years_with_targets.any? &&
    ![
      assessment.cp_alignment_2025,
      assessment.cp_alignment_2027,
      assessment.cp_alignment_2030,
      assessment.cp_alignment_2035,
      assessment.cp_alignment_2050
    ].compact.any? { |alignment| alignment&.downcase&.include?('not assessable') }
  } %>
<% if cp_sectors.any? %>
  <div style="margin: 25px 0">
    <%= react_component('charts/cp-performance/MultipleChart', {
      sectors: cp_sectors
    }) %>
  </div>
<% else %>
  <div style="margin: 25px 0; padding: 20px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; text-align: center; color: #666;">
    <p>No sector performance data available. This bank has not set assessable targets for any sectors.</p>
    <p><small>Note: Sectors with targets labeled as "not assessable" are not displayed.</small></p>
  </div>
<% end %>
