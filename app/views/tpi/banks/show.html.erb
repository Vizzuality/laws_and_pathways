<% content_for :page_title, "#{@bank.name} - Transition Pathway Initiative" %>
<% content_for :page_description, "Assess how prepared #{@bank.name} is for the transition to a low-carbon economy" %>

<div class="bank-page">
  <div class="dropdown-selector-wrapper">
    <%= react_component("BankDropdown", { banks: @banks_json, selectedOption: @bank.name }) %>

    <div class="bank-header container">
      <%= react_component('DownloadFormModal', {
        title: 'Explore Banks data access',
        buttonClass: 'button is-primary is-pulled-right with-icon with-border',
        downloadUrl: user_download_tpi_banks_path,
        source: 'banks',
        showIcon: true
      }) %>
    </div>
  </div>

  <section class="container summary-box">
    <div class="columns">
      <div class="column">
        <%= render 'tpi/shared/property', highlight: true, name: 'Geography', tooltip: t('tpi.tooltips.geography') do %>
          <%= @bank.geography.name %>
        <% end %>
      </div>
      <div class="column">
        <%= render 'tpi/shared/property', highlight: true, name: 'Sector' do %>
          <%= link_to "Banks", tpi_banks_path %>
        <% end %>
      </div>
      <div class="column">
        <%= render 'tpi/shared/property', highlight: false, name: 'Market cap (Group)', tooltip: t('tpi.tooltips.market_cap') do %>
          <%= @bank.market_cap_group %>
        <% end %>
      </div>
      <div class="column">
        <%= render 'tpi/shared/property', highlight: false, name: 'ISIN', tooltip: t('tpi.tooltips.ISIN') do %>
          <%= safe_join(@bank.isin_array, '<br/>'.html_safe) %>
        <% end %>
      </div>
      <div class="column">
        <%= render 'tpi/shared/property', highlight: false, name: 'SEDOL', tooltip: t('tpi.tooltips.SEDOL') do %>
          <%= @bank.sedol %>
        <% end %>
      </div>
    </div>
  </section>

  <% if @bank.cp_assessments.exists? %>
    <% has_2025_cp = @bank.cp_assessments.currently_published.where('assessment_date >= ?', Date.new(2025,1,1)).exists? %>
    <section class="container" id="cp-matrix">
      <% if has_2025_cp %>
        <%= render "cp_matrix", bank: @bank %>
      <% else %>
        <h3 class="cp_assessments_title" style="margin: 25px 0">Carbon Performance Alignment Matrix</h3>
        <div style="margin: 25px 0; padding: 20px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; color: #666;">
          <p>No 2025 Carbon Performance assessments available for this bank. The Alignment Matrix is shown for banks with 2025 data.</p>
          <p><small>The Carbon performance charts below may still display historical emissions where available.</small></p>
        </div>
      <% end %>
    </section>

    <section class="container" id="cp-assessment">
      <%= render "cp_assessments", bank: @bank %>
    </section>
  <% end %>

  <section class="container bank-assessment" id="assessment">
    <%= render 'assessment', assessment: @assessment_presenter %>
  </section>

  <% if @bank.latest_information.present? %>
    <%= react_component("LatestInformation", { name: @bank.name, latestInformation: @bank.latest_information }) %>
  <% end %>
</div>
